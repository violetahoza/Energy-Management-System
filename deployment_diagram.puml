@startuml Energy Management System - Deployment Diagram

left to right direction
skinparam componentStyle rectangle
skinparam packagePadding 20
skinparam componentPadding 10
skinparam databasePadding 10
skinparam nodesep 70
skinparam ranksep 150

skinparam component {
    BorderColor Black
}
skinparam database {
    BackgroundColor LightYellow
    BorderColor Black
}

actor "Browser" as browser

package "Docker Host" {

    package "Internal Network (energy_management_network)" {
        
        component "Traefik\nReverse Proxy\n(port 80, 8080)" as traefik #LightGreen

        component "Frontend\n(React)\n(port 3000)" as frontend #LightPink

        node "Backend Services" {
            component "Authorization Service\n(Spring Boot)\n(port 8083)" as auth #LightBlue
            component "User Service\n(Spring Boot)\n(port 8081)" as user #LightBlue
            component "Device Service\n(Spring Boot)\n(port 8082)" as device #LightBlue
        }

        node "Databases" {
            database "credentials_db\n(MySQL)\n(port 3306)" as creddb
            database "users_db\n(MySQL)\n(port 3306)" as usersdb
            database "devices_db\n(MySQL)\n(port 3306)" as devicesdb
        }
    }
}

' ========================
'        CONEXIUNI
' ========================

' --- Browser to Traefik ---
browser -down-> traefik : <b>HTTP :80</b>\n(public entry point)

' --- Traefik serves Frontend ---
traefik -right-> frontend : /

' --- Frontend API calls ---
frontend -[#Red,thickness=3]-> traefik : <color:Red>API calls</color>

' --- Traefik routing to services ---
traefik -right-> auth : <b>/api/auth/*</b>
traefik -right-> user : <b>/api/users/*</b>
traefik -right-> device : <b>/api/devices/*</b>

' --- Service to Database connections ---
auth -down-> creddb
user -down-> usersdb
device -down-> devicesdb

' --- Internal service-to-service communication ---
auth .[#Gray].> user : <color:Gray>/api/users/internal/profile</color>
user .[#Gray].> auth : <color:Gray>/api/auth/internal/credentials</color>
user .[#Gray].> device : <color:Gray>/api/devices/sync/unassign-user</color>
device .[#Gray].> user : <color:Gray>/api/users/internal/validate</color>

@enduml
